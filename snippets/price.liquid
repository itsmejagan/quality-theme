{%- liquid
  if use_variant
    assign target = product.selected_or_first_available_variant
  else
    assign target = product
  endif
  assign current_variant = product.selected_or_first_available_variant
  assign compare_at_price = target.compare_at_price
  assign price = target.price | default: 1999
  assign price_min = product.price_min
  assign price_max = product.price_max
  assign available = target.available | default: false
  assign money_price = price | money
  assign money_price_min = price_min | money
  assign money_price_max = price_max | money
  if settings.currency_code_enabled
    assign money_price = price | money_with_currency
    assign money_price_min = price_min | money_with_currency
    assign money_price_max = price_max | money_with_currency
  endif

  if target == product and product.price_varies
    assign money_price = 'products.product.price.from_price_html' | t: price: money_price
  endif
-%}

{%- unless target == null -%}
  <div
    class="
      price
      d-flex
      {% liquid
          assign column_alignment = section.settings.product_card_column_alignment
        if column_alignment == "left"
        echo "justify-content-start"
        elsif column_alignment == "center"
        echo "justify-content-center"
        elsif column_alignment == "right"
        echo "justify-content-end"
        endif
              
          echo ' column-gap-3 row-gap-2 align-items-center'

          if price_class
              echo price_class
          endif

          if available == false
              echo ' price--sold-out'
          endif

          if compare_at_price > price and product.quantity_price_breaks_configured? != true
              echo ' price--on-sale'
          endif

          if compare_at_price > price and product.quantity_price_breaks_configured?
              echo ' volume-pricing--sale-badge'
          endif

          if product.price_varies == false and product.compare_at_price_varies
              echo ' price--no-compare'
          endif

          if show_badges
              echo ' price--show-badge'
          endif
      %}
    "
  >
    <div class="price__container">
      <div class="price__regular ">
        {%- if product.quantity_price_breaks_configured? -%}
          {%- if show_compare_at_price and compare_at_price -%}
            {%- unless product.price_varies == false and product.compare_at_price_varies %}
              <span class="invisible visually-hidden">
                {{- 'products.product.price.regular_price' | t -}}
              </span>
              <span>
                <s class="price-item price-item--regular variant-item__old-price">
                  {%- liquid
                    if settings.currency_code_enabled
                      echo compare_at_price | money_with_currency
                    else
                      echo compare_at_price | money
                    endif
                  %}
                </s>
              </span>
            {%- endunless -%}
          {%- endif -%}
          <span class="invisible visually-hidden">{{ 'products.product.price.regular_price' | t }}</span>
          <span class="price-item price-item--regular">
            {{-
              'products.product.volume_pricing.price_range'
              | t: minimum: money_price_min, maximum: money_price_max
            -}}
          </span>
        {%- else -%}
          <span class="invisible visually-hidden">{{ 'products.product.price.regular_price' | t }}</span>
          <span class="price-item price-item--regular">
            {{ money_price }}
          </span>
        {%- endif -%}
      </div>
      <div
        class="
          price__sale d-flex {% liquid
           assign column_alignment = section.settings.product_card_column_alignment
        if column_alignment == "left"
        echo "justify-content-start"
        elsif column_alignment == "center"
        echo "justify-content-center"
        elsif column_alignment == "right"
        echo "justify-content-end"
        endif
          %} flex-wrap align-items-center gap-1
        "
      >
        <span class="invisible visually-hidden ">{{ 'products.product.price.sale_price' | t }}</span>
        <span class="price-item price-item--sale special-price">{{ money_price }}</span>
        {%- unless product.price_varies == false and product.compare_at_price_varies %}
          <span class="invisible visually-hidden">{{ 'products.product.price.regular_price' | t }}</span>
          <span class="ms-0">
            <s class="price-item price-item--regular original-price variant-item__old-price">
              {%- liquid
                if settings.currency_code_enabled
                  echo compare_at_price | money_with_currency
                else
                  echo compare_at_price | money
                endif
              %}
            </s>
          </span>
        {%- endunless -%}
      </div>
      <small class="unit-price {% if current_variant.unit_price_measurement == nil %} visually-hidden {% endif %}">
        <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
        <span class="price-item price-item--last">
          <span>{{- current_variant.unit_price | money -}}</span>
          <span aria-hidden="true">/</span>
          <span class="visually-hidden">&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span>
          <span>
            {%- liquid
              if current_variant.unit_price_measurement.reference_value != 1
                echo current_variant.unit_price_measurement.reference_value
              endif
              echo current_variant.unit_price_measurement.reference_unit
            %}
          </span>
        </span>
      </small>
    </div>
    {%- if show_badges -%}
      <span class="h5 mb-0 price__badge-sale text-success">
        {{ 'products.product.on_sale' | t }}
      </span>

      <span class="h5 mb-0 price__badge-sold-out text-danger">
        {{ 'products.product.sold_out' | t }}
      </span>
    {%- endif -%}
  </div>
{% endunless %}
